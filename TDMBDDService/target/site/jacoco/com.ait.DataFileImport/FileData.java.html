<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FileData.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">TDMBDDService</a> &gt; <a href="index.source.html" class="el_package">com.ait.DataFileImport</a> &gt; <span class="el_source">FileData.java</span></div><h1>FileData.java</h1><pre class="source lang-java linenums">package com.ait.DataFileImport;

import java.io.*;
import java.text.DateFormat;
import java.text.SimpleDateFormat;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.util.ArrayList;
import java.util.List;
import org.apache.poi.EncryptedDocumentException;
import org.apache.poi.hssf.usermodel.HSSFDateUtil;
import org.apache.poi.openxml4j.exceptions.InvalidFormatException;
import org.apache.poi.ss.usermodel.Cell;
import org.apache.poi.ss.usermodel.CellType;
import org.apache.poi.ss.usermodel.Row;
import org.apache.poi.ss.usermodel.Sheet;
import org.apache.poi.ss.usermodel.Workbook;
import org.apache.poi.ss.usermodel.WorkbookFactory;

import com.ait.callData.BaseData;


public class FileData {
	private Workbook workbook;
	public static List&lt;String&gt; excelDataList;
	private List&lt;BaseData&gt; baseDataList;
	private DateTimeFormatter formatter;
	public static String worksheetName;
	public static long rowNumber;

<span class="nc" id="L31">	public FileData() {</span>
<span class="nc" id="L32">	}</span>

<span class="fc" id="L34">	public FileData(final InputStream fileInputStream) {</span>
		try {
<span class="fc" id="L36">			workbook = WorkbookFactory.create(fileInputStream);</span>
<span class="nc" id="L37">		} catch ( EncryptedDocumentException | InvalidFormatException |IOException e) {</span>
<span class="nc" id="L38">			throw new IllegalStateException(e);</span>
<span class="fc" id="L39">		}</span>
<span class="fc" id="L40">		excelDataList = new ArrayList&lt;String&gt;();</span>
<span class="fc" id="L41">		baseDataList = new ArrayList&lt;BaseData&gt;();</span>

<span class="fc" id="L43">		formatter = DateTimeFormatter.ofPattern(&quot;MM/dd/yyyy HH:mm:ss&quot;);</span>
<span class="fc" id="L44">		rowNumber = 0;</span>
<span class="fc" id="L45">		worksheetName = &quot;&quot;;</span>
<span class="fc" id="L46">	}</span>

	public boolean importWorkbook() throws IOException {
<span class="pc bpc" id="L49" title="2 of 4 branches missed.">		if (workbook.getNumberOfSheets() != 5 || workbook.getSheetAt(0).getRow(0).getLastCellNum() != 14) {</span>
<span class="nc" id="L50">			return false;</span>
		}
<span class="fc bfc" id="L52" title="All 2 branches covered.">		for (int i = 1; i &lt; workbook.getNumberOfSheets(); i++) {</span>
<span class="fc" id="L53">			importSheets(i);</span>
		}
<span class="fc" id="L55">		importSheets(0);// base data</span>
<span class="fc" id="L56">		return true;</span>
	}

	/*
	 * Loops through each cell in each row of the excel document and adds it to a
	 * list An object of the relevant type is created from this list and the list is
	 * cleared
	 */
	public void importSheets(final int sheetNumber) throws IOException {
<span class="fc" id="L65">		worksheetName = workbook.getSheetName(sheetNumber);</span>
<span class="fc" id="L66">		final Sheet spreadsheet = workbook.getSheetAt(sheetNumber);</span>
<span class="fc bfc" id="L67" title="All 2 branches covered.">		for (int i = 1; i &lt;= spreadsheet.getLastRowNum(); i++) {</span>
<span class="fc" id="L68">			final Row row = spreadsheet.getRow(i);</span>
<span class="fc bfc" id="L69" title="All 2 branches covered.">			for (final Cell cell : row) {</span>
<span class="fc bfc" id="L70" title="All 4 branches covered.">				if (cell.getCellTypeEnum() == CellType.NUMERIC &amp;&amp; HSSFDateUtil.isCellDateFormatted(cell)) {</span>
<span class="fc" id="L71">					final DateFormat dateFormat = new SimpleDateFormat(&quot;MM/dd/yyyy HH:mm:ss&quot;);</span>
<span class="fc" id="L72">					excelDataList.add(dateFormat.format(cell.getDateCellValue()));</span>
<span class="fc bfc" id="L73" title="All 2 branches covered.">				} else if (cell.getCellTypeEnum() == CellType.NUMERIC) {</span>
<span class="fc" id="L74">					excelDataList.add(Double.toString(cell.getNumericCellValue()));</span>
<span class="pc bpc" id="L75" title="1 of 2 branches missed.">				} else if (cell.getCellTypeEnum() == CellType.STRING) {</span>
<span class="fc bfc" id="L76" title="All 2 branches covered.">					if (cell.toString().equals(&quot;(null)&quot;)) {</span>
<span class="fc" id="L77">						excelDataList.add(null);</span>
					} else {
<span class="fc" id="L79">						excelDataList.add(cell.toString());</span>
					}
				}
<span class="fc" id="L82">			}</span>
<span class="fc" id="L83">			rowNumber = i;</span>
<span class="fc" id="L84">			this.addObjectToList(sheetNumber);</span>
		}
<span class="fc" id="L86">		workbook.close();</span>
<span class="fc" id="L87">	}</span>

	/*
	 * Adds an object to the relevant object list depending on the sheet number
	 * @param number of the excel sheet of the object
	 */
	public void addObjectToList(final int sheetNumber) {
<span class="fc bfc" id="L94" title="All 2 branches covered.">		switch (sheetNumber) {</span>
		case 0:
			//if (!tableFilter.isBaseDataValid(excelDataList)) {
			//	break;
			//}
<span class="fc" id="L99">			final LocalDateTime dateTime = LocalDateTime.parse(excelDataList.get(0), formatter);</span>

<span class="fc" id="L101">			final BaseData baseData = new BaseData.Builder().date_time(dateTime)</span>
<span class="fc" id="L102">					.event_id((int) Double.parseDouble(excelDataList.get(1))).failure_class(excelDataList.get(2))</span>
<span class="fc" id="L103">					.ue_type((int) Double.parseDouble(excelDataList.get(3)))</span>
<span class="fc" id="L104">					.market((int) Double.parseDouble(excelDataList.get(4)))</span>
<span class="fc" id="L105">					.operator((int) Double.parseDouble(excelDataList.get(5)))</span>
<span class="fc" id="L106">					.cell_id((int) Double.parseDouble(excelDataList.get(6)))</span>
<span class="fc" id="L107">					.duration((int) Double.parseDouble(excelDataList.get(7)))</span>
<span class="fc" id="L108">					.cause_code((int) Double.parseDouble(excelDataList.get(8))).ne_version(excelDataList.get(9))</span>
<span class="fc" id="L109">					.imsi((long) Double.parseDouble(excelDataList.get(10)))</span>
<span class="fc" id="L110">					.hier3_id((long) Double.parseDouble(excelDataList.get(11)))</span>
<span class="fc" id="L111">					.hier32_id((long) Double.parseDouble(excelDataList.get(12)))</span>
<span class="fc" id="L112">					.hier321_id((long) Double.parseDouble(excelDataList.get(13))).build();</span>

<span class="fc" id="L114">			baseDataList.add(baseData);</span>
			break;
	/*
	 * only testing one sheet for now 
	 * 	case 1:
	 
			if (!tableFilter.isEventCauseValid(excelDataList)) {
				break;
			}
			final EventCause eventCause = new EventCause((int) Double.parseDouble(excelDataList.get(0)),
					(int) Double.parseDouble(excelDataList.get(1)), excelDataList.get(2));
			eventCauseList.add(eventCause);
			break;
		case 2:
			if (!tableFilter.isFailureClassValid(excelDataList)) {
				break;
			}
			final FailureClass failureClass = new FailureClass((int) Double.parseDouble(excelDataList.get(0)),
					excelDataList.get(1));
			failureClassList.add(failureClass);
			break;
		case 3:
			if (!tableFilter.isUEValid(excelDataList)) {
				break;
			}
			final UE ue = new UE((int) Double.parseDouble(excelDataList.get(0)), excelDataList.get(1),
					excelDataList.get(2), excelDataList.get(3), excelDataList.get(4), excelDataList.get(5),
					excelDataList.get(6), excelDataList.get(7), excelDataList.get(8));
			ueList.add(ue);
			break;
		case 4:
			if (!tableFilter.isMCC_MNCValid(excelDataList)) {
				break;
			}

			final MccMnc mcc_mnc = new MccMnc((int) Double.parseDouble(excelDataList.get(0)),
					(int) Double.parseDouble(excelDataList.get(1)), excelDataList.get(2), excelDataList.get(3));
			mcc_mncList.add(mcc_mnc);
			break;
			****************/
		}    
<span class="fc" id="L155">		excelDataList.clear();</span>
<span class="fc" id="L156">	}</span>

	public Workbook getWorkbook() {
<span class="nc" id="L159">		return workbook;</span>
	}

	public List&lt;BaseData&gt; getBaseDataList() {
<span class="fc" id="L163">		return baseDataList;</span>
	}
/*
	public List&lt;EventCause&gt; getEventCauseList() {
		return eventCauseList;
	}

	public List&lt;FailureClass&gt; getFailureClassList() {
		return failureClassList;
	}

	public List&lt;UE&gt; getUeList() {
		return ueList;
	}

	public List&lt;MccMnc&gt; getMcc_mncList() {
		return mcc_mncList;
	}

	public TableFilter getTableFilter() {
		return tableFilter;
	}
*/
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>